<mat-card class="cardWithShadow theme-card">
  <mat-card-header>
    <mat-card-title class="m-b-0">
      <span
        class="iconify me-2"
        [attr.data-icon]="'solar:pen-new-square-outline'"
        data-inline="false"
        style="font-size: 28px;">
      </span>
      Asignar Firmas al Formato
      <span class="event-info">{{ tbFormatoCertificado?.nombreFormato }}</span>
    </mat-card-title>
  </mat-card-header>

  <mat-card-content class="b-t-1">
    <!-- Informaci贸n del evento -->
    <div class="event-details-section">
      <div class="event-detail-item">
        <mat-icon>event</mat-icon>
        <span><strong>C贸digo:</strong> {{ tbFormatoCertificado?.codigo }}</span>
      </div>
    </div>

    <!-- Informaci贸n de firmas seleccionadas -->
    <div class="selection-info">
      <mat-chip-set>
        <mat-chip class="selection-chip">
          <mat-icon>check_circle</mat-icon>
          {{ selectedFirmas.length }} firma(s) seleccionada(s)
        </mat-chip>
        <mat-chip class="total-chip">
          <mat-icon>list</mat-icon>
          {{ rowData.length }} firma(s) disponible(s)
        </mat-chip>
      </mat-chip-set>

      <button
        mat-stroked-button
        color="primary"
        (click)="selectAll()"
        *ngIf="selectedFirmas.length < rowData.length"
        class="ms-2">
        <mat-icon>done_all</mat-icon>
        Seleccionar todas
      </button>

      <button
        mat-stroked-button
        color="warn"
        (click)="deselectAll()"
        *ngIf="selectedFirmas.length > 0"
        class="ms-2">
        <mat-icon>clear</mat-icon>
        Deseleccionar todas
      </button>
    </div>

    <!-- Grid de firmas -->
    <div class="grid-container">
      <ag-grid-angular
        #agGrid
        [style.height]="'50vh'"
        style="width: 100%;"
        class="ag-theme-alpine"
        [rowData]="rowData"
        [columnDefs]="colDefs"
        [gridOptions]="gridOptions"
        [rowSelection]="'multiple'"
        [suppressRowClickSelection]="true"
        (gridReady)="onGridReady($event)"
        (selectionChanged)="onSelectionChanged($event)">
      </ag-grid-angular>
    </div>

    <!-- Lista de firmas seleccionadas -->
    <div class="selected-firmas-section" *ngIf="selectedFirmas.length > 0">
      <h3 class="section-title">
        <mat-icon>playlist_add_check</mat-icon>
        Firmas Seleccionadas
      </h3>

      <div class="selected-firmas-list">
        <mat-chip-set>
          <mat-chip
            *ngFor="let firma of selectedFirmas"
            [removable]="true"
            (removed)="removeFirma(firma)">
            <div class="firma-chip-content">
              <img
                *ngIf="firma.imagen"
                [src]="'data:image/png;base64,' + firma.imagen"
                class="firma-chip-image"
                alt="Firma">
              <span class="firma-chip-text">
                {{ firma.codigo }} - {{ firma.nombre }}
              </span>
            </div>
            <mat-icon matChipRemove>cancel</mat-icon>
          </mat-chip>
        </mat-chip-set>
      </div>
    </div>
  </mat-card-content>

  <mat-card-footer class="p-3">
    <div class="d-flex justify-content-between align-items-center">
      <div class="footer-info">
        <mat-icon class="info-icon">info</mat-icon>
        <span>Selecciona las firmas que deseas asignar a este evento</span>
      </div>

      <div class="d-flex gap-2">
        <button
          mat-stroked-button
          type="button"
          (click)="onCancel()"
          [disabled]="isLoading">
          <mat-icon>close</mat-icon>
          Cancelar
        </button>

        <button
          mat-flat-button
          color="primary"
          type="button"
          (click)="onSave()"
          [disabled]="isLoading || selectedFirmas.length === 0"
          class="ms-2">
          <mat-icon *ngIf="!isLoading">save</mat-icon>
          <mat-icon *ngIf="isLoading" class="spinning">sync</mat-icon>
          {{ isLoading ? 'Guardando...' : 'Guardar Asignaci贸n' }}
          <span class="badge-count" *ngIf="selectedFirmas.length > 0">
            {{ selectedFirmas.length }}
          </span>
        </button>
      </div>
    </div>
  </mat-card-footer>
</mat-card>
